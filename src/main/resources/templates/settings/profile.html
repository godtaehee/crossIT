<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>

  <th:block th:include="layout/fragment/head :: head"></th:block>

  <style>

    .modal-overlay {
      background-color: rgba(90, 90, 90, 0.082);
      width: 100%;
      height: 100%;
      position: absolute;
    }

    .modal-content {
      background-color: rgb(255, 255, 255);
      text-align: center;
      box-shadow: 0 10px 20px rgba(131, 131, 131, 0.068), 0 6px 6px rgba(128, 128, 128, 0.089);
      position: relative;
      width: 400px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 50px;
      min-height: 70vh;
    }

    .message {
      height: 150px;
    }

    .log_btn button:nth-child(2) {
      margin-left: 30px;
    }

    .log_btn button {
      margin-left: 10px;
    }

    .profile {
      display: flex;
    }

    .introduction {
      margin-left: 15px;
      width: 100%;
    }

    .user-name {
      display: flex;
    }

    .profile-phone,
    .profile-location {
      display: flex;
      align-items: center;
    }

    .title {
      margin-right: 10px;
    }

  </style>
</head>

<body>


<div class="card-list-con container">

  <!-- 헤더-->
  <header th:replace="layout/fragment/header :: header"></header>

  <!-- 유저 자신의 프로필일때-->
  <div class="user-profile">

    <div class="profile">
      <div class="card text-center">
        <div class="card-header">
          프로필 이미지
        </div>
        <div id="current-profile-image" class="mt-3">
          <svg th:if="${#strings.isEmpty(profile.profileImage)}" class="rounded"
               th:data-jdenticon-value="${member.nickname}" width="125" height="125"></svg>
          <img th:if="${!#strings.isEmpty(profile.profileImage)}" class="rounded"
               th:src="${profile.profileImage}"
               width="125" height="125" alt="name" th:alt="${member.nickname}"/>
        </div>
        <div id="new-profile-image" class="mt-3"></div>
        <div class="card-body">
          <div class="custom-file">
            <input type="file" class="custom-file-input" id="profile-image-file">
          </div>
          <div id="new-profile-image-control" class="mt-3">
            <button class="btn btn-outline-primary btn-block" id="cut-button">자르기</button>
            <button class="btn btn-outline-success btn-block" id="confirm-button">확인</button>
            <button class="btn btn-outline-warning btn-block" id="reset-button">취소</button>
          </div>
          <div id="cropped-new-profile-image" class="mt-3"></div>
        </div>
      </div>

      <div class="title is-4 is spaced" id="nick" th:text="*{member.nickname}">Minchocho</div>
      <form th:action="@{/settings/profile}" th:object="${profile}" method="post">
        <div class="introduction">
          <div class="user-name">
            <input type="submit" class="button is-info is-light is-inverted is-small edit-btn" value="수정 완료"/>
          </div>
          <input class="form-control input-sm mb-2" placeholder="간략한 소개를 부탁드립니다." th:field="*{introduction}"/>
          <div class="profile-location">
            <i class="fas fa-map-marker-alt mr-2"></i>
            <input class="form-control input-sm mb-2" placeholder="지역을 설정해 주세요." th:field="*{location}"/>
          </div>
          <div class="profile-phone">
            <i class="fas fa-phone-alt mr-1"></i>
            <input class="form-control input-sm mb-2" placeholder="연락처를 입력해 주세요." th:field="*{contact}"/>
          </div>
        </div>
        <div class="form-group">
          <input type="hidden" id="profileImage" th:field="*{profileImage}" class="form-control"/>
        </div>
      </form>
    </div>
  </div>


  <!--유저 프로필 영역 end -->

  <div class="category">
    <div class="tabs ">
      <ul>
        <li class="is-active"><a>글</a></li>
        <li><a>작업물</a></li>
        <li><a>소개</a></li>
        <li><a>정보</a></li>
      </ul>
    </div>
  </div>


  <section class="section contents">

    <section class="tag-list">
      <p class="mt-6">태그 목록</p>
      <hr class="mt-2" width="100px">
      <span class="tagList">
                <p class="mr-2"> 전체 보기 </p> 
                <p>(20)</p>
            </span>
    </section>

    <section class="hero is-small">

      <div class="searchtags">
        <div class="search-form search">
          <p class="control has-icons-left">
            <input class="input is-hovered is-small" type="text" placeholder="검색어를 입력하세요"/>
            <span class="icon is-left">
            <i class="fas fa-search" aria-hidden="true"></i>
            </span>
          </p>
          <a href="/board/write">
            <button class="btn-write button is-rounded">글쓰기</button>
          </a>
        </div>
      </div>

      <div class="hero-body">
        <div class="container">
          <div class="columns mr-0">
            <div class="column is-8 is-offset-1">
              <figure class="image is-16by9">
                <img src="/img/index.png" alt="">
              </figure>
            </div>
          </div>

          <section class="section">
            <div class="columns">
              <div class="column is-8 is-offset-1">
                <div class="content is-medium">
                  <h1 class="title is-3">Getting Started</h1>
                  <p>This is a starter template for creating a beautiful, customizable blog with minimal
                    effort. You’ll only have to change a few settings and you’re ready to go. As with all Jigsaw
                    sites,
                    configuration settings can be found in config</p>
                  <h2 class="subtitle is-6">December 25, 2018</h2>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </section>


</div>

<div class="modal modal-fx-fadeInScale">
  <div class="modal-overlay"></div>
  <div class="modal-content ">
    <form th:action="@{/admin/sendTeam}" th:object="${member}" method="post">
      <h2 class="mb-4" th:text="*{nickname}"> Minchocho </h2> 님께 팀요청을 보내보세요!
      <div class="form-control">
        <label for="username">닉네임</label>
        <input type="text" id="username" placeholder="닉네임을 입력해주세요">
      </div>
      <div class="form-control">
        <label for="username">연락처(선택)</label>
        <input type="text" id="contact" placeholder="연락처를 입력해주세요">
      </div>
      <div class="form-control">
        <label for="username">메세지</label>
        <input type="text" id="message" placeholder="메세지를 입력해주세요" class="message">
      </div>
      <div class="form-control">
        <button class="button is-primary is-light" type="submit">전송하기</button>
      </div>
    </form>
    <button class="close">X</button>
  </div>
</div>

<link href="/node_modules/cropper/dist/cropper.min.css" rel="stylesheet">
<script src="/node_modules/cropper/dist/cropper.min.js"></script>
<script src="/node_modules/jquery-cropper/dist/jquery-cropper.min.js"></script>
<script type="application/javascript">
  $(function () {
    cropper = '';
    let $confirmBtn = $("#confirm-button");
    let $resetBtn = $("#reset-button");
    let $cutBtn = $("#cut-button");
    let $newProfileImage = $("#new-profile-image");
    let $currentProfileImage = $("#current-profile-image");
    let $resultImage = $("#cropped-new-profile-image");
    let $profileImage = $("#profileImage");

    $newProfileImage.hide();
    $cutBtn.hide();
    $resetBtn.hide();
    $confirmBtn.hide();

    $("#profile-image-file").change(function (e) {
      if (e.target.files.length === 1) {
        const reader = new FileReader();
        reader.onload = e => {
          if (e.target.result) {
            let img = document.createElement("img");
            img.id = 'new-profile';
            img.src = e.target.result;
            img.width = 250;

            $newProfileImage.html(img);
            $newProfileImage.show();
            $currentProfileImage.hide();

            let $newImage = $(img);
            $newImage.cropper({aspectRatio: 1});
            cropper = $newImage.data('cropper');

            $cutBtn.show();
            $confirmBtn.hide();
            $resetBtn.show();
          }
        };

        reader.readAsDataURL(e.target.files[0]);
      }
    });

    $resetBtn.click(function () {
      $currentProfileImage.show();
      $newProfileImage.hide();
      $resultImage.hide();
      $resetBtn.hide();
      $cutBtn.hide();
      $confirmBtn.hide();
      $profileImage.val('');
    });

    $cutBtn.click(function () {
      let dataUrl = cropper.getCroppedCanvas().toDataURL();
      let newImage = document.createElement("img");
      newImage.id = "cropped-new-profile-image";
      newImage.src = dataUrl;
      newImage.width = 125;
      $resultImage.html(newImage);
      $resultImage.show();
      $confirmBtn.show();

      $confirmBtn.click(function () {
        $newProfileImage.html(newImage);
        $cutBtn.hide();
        $confirmBtn.hide();
        $profileImage.val(dataUrl);
      });
    });
  });


  (() => {

    const openBtn = document.getElementById("open");
    const modal = document.querySelector(".modal");
    const overlay = modal.querySelector(".modal-overlay");
    const closeBtn = modal.querySelector(".close");
    console.log(closeBtn);

    const test = (e) => {
      e.preventDefault();
      modal.classList.toggle('is-active');
    }

    overlay.addEventListener("click", test);
    closeBtn.addEventListener("click", test);
    openBtn.addEventListener("click", test);


    const profile = document.querySelector('.profile');
    const profileEdit = document.querySelector('.profile-edit');

    document.querySelector('.edit-btn').addEventListener('click', () => {

      profile.classList.toggle('d-none');
      profileEdit.classList.toggle('d-none');

    })


  })();

</script>

</body>
</html>
